!function(a,b){"use strict";var c=(b.model.extend("SubmitSignupModel",{properties:{apiEndpoint:""}}),b.model.extend("UserSignupModel",{properties:{displayName:"",email:"",password:"",dateOfBirth:"",gender:"",city:"",state:"",bio:""}})),d=(b.view.extend("NavigationView",{container:".js-navigation-view",$:{prevBtn:".js-prev-btn : click",nextBtn:".js-next-btn : click"},init:function(){},enableBtn:function(a,b){this.$[a+"Btn"].attr("disabled",!b)},setBtnLabel:function(a,b){this.$[a+"Btn"].text(b)}}),b.view.extend("WizardView",{init:function(){},setVisible:function(a){this.container[a?"addClass":"removeClass"]("show")},setInputError:function(a,b){if(1===arguments.length)return this.setInputError(Object.keys(this.$),a);if("string"==typeof a)return this.setInputError([a||Object.keys(this.$)],b);for(var c in a)this.$[a[c]].parent()[b?"addClass":"removeClass"]("has-error")}})),e=(d.extend("BasicInfoView",{container:".js-basic-info-view",$:{displayName:".js-display-name-input : change keyup blur",email:".js-email-input : change keyup blur",password1:".js-password-1-input : change keyup blur",password2:".js-password-2-input : change keyup blur"}}),d.extend("OtherInfoView",{container:".js-other-info-view",$:{profileImg:".js-profile-file : change fileselect",profileLabel:".js-profile-input : change blur",dob:".js-dob-input : change keyup blur",gender:".js-gender-input : change keyup blur",city:".js-city-input : change keyup blur",state:".js-state-input : change keyup blur",bio:".js-bio-input : change keyup blur"},init:function(){a(document).on("change",".btn-file :file",function(){var b=a(this),c=(b.get(0).files||[0]).length,d=b.val().replace(/\\/g,"/").replace(/.*\//,"");b.trigger("fileselect",[c,d])})}}),d.extend("SubmitSignupView",{container:".js-submit-signup-view",$:{},init:function(){}}),d.extend("VerifyEmailView",{container:".js-verify-signup-view",$:{verifyCodeText:".js-verify-code-input : keyup change blur",resendEmailLink:".js-resend-email"},init:function(){}}),b.presenter.extend("NavigationPresenter",{views:["NavigationView"],events:{"navigation:next":"onNext","navigation:previous":"onPrev","navigation:buttons:state":"onSetBtnState","navigation:buttons:label":"onSetBtnLabel","navigation:hide":"onNavigationHide","navigation:show":"onNavigationShow"},init:function(a){this.presenters=a.presenters,this.currentIndex=a.currentIndex||0,b.events.on("view:"+this.view.id+":prevBtn click",this.onPrevClick.bind(this)).on("view:"+this.view.id+":nextBtn click",this.onNextClick.bind(this))},onNextClick:function(a){a.preventDefault(),this.onNext()},onNext:function(){this.currentIndex=this.currentIndex<this.presenters.length-1?this.currentIndex+1:this.currentIndex,this.view.enableBtn("next",this.currentIndex!==this.presenters.length-1),this.view.enableBtn("prev",!0),b.events.trigger("presenter:show",this.presenters[this.currentIndex].id)},onPrevClick:function(a){a.preventDefault(),this.onPrev()},onPrev:function(){this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.currentIndex,this.view.enableBtn("prev",!!this.currentIndex),this.view.enableBtn("next",!0),b.events.trigger("presenter:show",this.presenters[this.currentIndex].id)},onSetBtnState:function(a){for(var b in a)this.view.enableBtn(b,a[b])},onSetBtnLabel:function(a){for(var b in a)this.view.setBtnLabel(b,a[b])},onNavigationHide:function(){this.view.container.slideDown()},onNavigationShow:function(){this.view.container.slideUp()}})),f=b.presenter.extend("WizardPresenter",{views:["WizardView"],events:{"presenter:show":"onShow"},init:function(){this.isValid=!1},onShow:function(a){return this.view.setVisible(a===this.id),a===this.id},validateField:function(a){return""!==a.trim()},validateForm:function(c){if(9===c.which)return this.isValid=!1;if(!this.validateField(a(c.target).val()))return b.events.trigger("navigation:buttons:state",{next:!1}),a(c.target).parent().addClass("has-error"),this.isValid=!1;for(var c in this.view.$){var d=this.view.$[c];if(!this.validateField(d.val()))return b.events.trigger("navigation:buttons:state",{next:!1}),this.isValid=!1;this.view.setInputError(c,!1)}return this.view.setInputError(!1),b.events.trigger("navigation:buttons:state",{next:!0}),this.isValid=!0},updateModel:function(a,b){if(this.validateForm(b))for(var c in this.view.$){var d=this.view.$[c];d.data("modelBind")&&a.property(d.data("modelBind"),d.val())}}}),g=f.extend("BasicInfoPresenter",{views:["BasicInfoView"],init:function(a){this.userModel=a.userModel,this.models.push(a.userModel);var c="view:"+this.view.id+":";for(var d in this.view.$)b.events.on(c+d+" change",this.updateModel.bind(this,this.userModel)).on(c+d+" keyup",this.updateModel.bind(this,this.userModel))},onShow:function(a){f.prototype.onShow.call(this,a)&&b.events.trigger("navigation:buttons:label",{next:"Next"})}}),h=f.extend("OtherInfoPresenter",{views:["OtherInfoView"],init:function(a){this.userModel=a.userModel,this.models.push(a.userModel);var c="view:"+this.view.id+":";for(var d in this.view.$)b.events.on(c+d+" change",this.updateModel.bind(this,this.userModel)).on(c+d+" keyup",this.updateModel.bind(this,this.userModel));this.view.$.profileImg.on("fileselect",this.onProfileImgSelect.bind(this))},onShow:function(a){f.prototype.onShow.call(this,a)&&b.events.trigger("navigation:buttons:state",{next:this.isValid}).trigger("navigation:buttons:label",{next:"Done"})},onProfileImgSelect:function(a,b,c){this.view.$.profileLabel.val(c)},validateForm:function(a){var b=this.view.$.profileLabel;delete this.view.$.profileLabel;var c=f.prototype.validateForm.call(this,a);return this.view.$.profileLabel=b,c}}),i=f.extend("SubmitSignupPresenter",{views:["SubmitSignupView"],models:["SubmitSignupModel"],init:function(b){this.userModel=b.userModel,this.models.push(b.userModel),this.model.property("apiEndpoint",a("script[data-api-endpoint]").data("apiEndpoint"))},onShow:function(a){f.prototype.onShow.call(this,a)&&(b.events.trigger("navigation:buttons:state",{prev:!1,next:!1}),setTimeout(this.signupRequest.bind(this),2e3))},signupRequest:function(){a.ajax({type:"POST",url:this.model.property("apiEndpoint")+"users",dataType:"json",data:this.userModel.properties}).done(this.signupRequestSuccess).fail(this.signupRequestError)},signupRequestSuccess:function(){b.events.trigger("navigation:next")},signupRequestError:function(){b.events.trigger("navigation:next")}}),j=f.extend("VerifyEmailPresenter",{views:["VerifyEmailView"],init:function(){b.events.on("view:"+this.view.id+":verifyCodeText change",this.validateCode.bind(this)).on("view:"+this.view.id+":verifyCodeText keyup",this.validateCode.bind(this)).on("view:"+this.view.id+":verifyCodeText blur",this.validateCode.bind(this))},onShow:function(a){f.prototype.onShow.call(this,a)&&b.events.trigger("navigation:buttons:state",{prev:!1,next:!1}).trigger("navigation:buttons:label",{next:"Verify"})},validateCode:function(){b.events.trigger("navigation:buttons:state",{next:""!==this.view.$.verifyCodeText.val().trim()})}}),k=new c;a(function(){{var a=new g({id:"basicInfoPresenter",userModel:k}),b=new h({id:"otherInfoPresenter",userModel:k}),c=new i({id:"submitSignupPresenter",userModel:k}),d=new j({id:"verifyEmailPresenter",userModel:k});new e({presenters:[a,b,c,d]})}})}(jQuery,champ);